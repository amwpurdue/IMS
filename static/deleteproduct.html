<!DOCTYPE html>
<html>
<head>
  <title>AJAX POST Request</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>Product Management</h1>
<!--  <p>-->
<!--    <form id="delete_product">-->
<!--      <label for="product_id">Product ID:</label>-->
<!--      <input type="text" id="product_id" name="product_id" required>-->
<!--      <br>-->
<!--      <br>-->
<!--      <button type="button" onclick="deleteProduct()">Delete Product</button>-->
<!--    </form>-->
<!--  </p>-->
  <p>
    <form id="delete_all">
      <button type="button" onclick="getAll(deleteAll)">Delete all Products</button>
    </form>
  </p>


  <script>
    function getAll(successFunction) {
      $.ajax({
        type: "GET",
        url: "/products/",
        contentType: "application/json",
        success: function(response) {
          successFunction(response)
        },
        error: function(error) {
          console.error(error);
          alert("An error occurred while submitting the data.");
        }
      });
    }
    function deleteProduct() {
      // Get the form data
      var formData = {
        product_id: document.getElementById("product_id").value,
      };

      // Make the AJAX POST request
      $.ajax({
        type: "DELETE",
        url: "/products/" + formData["product_id"],
        data: JSON.stringify(formData),
        contentType: "application/json",
        success: function(response) {
          // Handle the response from the server
          alert("Data successfully deleted!");
        },
        error: function(error) {
          // Handle any errors that occurred during the AJAX request
          console.error(error);
          alert("An error occurred while submitting the data.");
        }
      });
    }
    function deleteAll(getAllResponse) {
      if (!getAllResponse.products || !Array.isArray(getAllResponse.products)) {
        throw new Error("Missing data from getAll response");
      }

      const productIds = getAllResponse.products;

      $.ajax({
        type: "DELETE",
        url: "/products/",
        data: JSON.stringify({"products": productIds}),
        contentType: "application/json",
        success: function(response) {
          // Handle the response from the server
          alert("Data successfully deleted!");
        },
        error: function(error) {
          // Handle any errors that occurred during the AJAX request
          console.error(error);
          alert("An error occurred while submitting the data.");
        }
      });
    }
  </script>
</body>
</html>
